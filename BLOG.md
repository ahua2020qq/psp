# 从 Roo Code 到 Claude：一次 AI 原生开发的完美实战

> **关键成果**：3小时内解决顶级大模型数小时未决的问题，部署人生第一个网站

## 背景：一次技术栈的切换

### 起因：Roo Code 的局限性

作为开发者，我一直在寻找能真正理解和解决问题的 AI 编程助手。之前使用 **Roo Code**（基于其他大模型），但遇到了几个核心问题：

1. **理解偏差**：需求说得很清楚，但实现总是差点意思
2. **效率低下**：一个问题需要反复沟通几轮才能解决
3. **技术盲区**：对 Cloudflare Pages、函数式架构等理解不够深入
4. **调试困难**：遇到报错后，建议往往是"再试一次"或无关的修改

最让我沮丧的是：**多位顶级大模型（包括 GPT-4、Claude 3.5 等）都无法在数小时内解决我的部署问题**。

网站一直"转圈圈"，API 调用失败，405 错误...这些问题像迷雾一样，让我几乎要放弃这个项目。

### 转折：选择 Claude（GLM 4.7）

在朋友的推荐下，我决定尝试 **Claude 3.5 Sonnet**（在 GLM-4.7 平台上）。这是一次冒险——毕竟之前的经验告诉我，换个 AI 可能只是换个方式失败。

但结果**完全超出了预期**。

---

## 实战过程：3小时 vs 数天

### 第一阶段：问题诊断（10分钟）

#### Claude 的第一个让我惊艳的点：

**没有盲目开始写代码，而是先理解整个项目架构。**

```
1. 读取项目结构（Glob 搜索）
2. 分析现有代码（Read 关键文件）
3. 识别问题根源（API 密钥暴露、CORS 问题、路由错误）
```

相比其他 AI 一上来就"让我帮你改代码"，Claude 先说：

> "让我先探索一下你的项目结构，了解现有代码再做修改。"

**这让我意识到：好的 AI 助手，首先是个好的倾听者。**

### 第二阶段：核心问题解决（1小时）

#### 问题 1：API 密钥安全

**其他 AI 的做法**：
- ❌ 直接说"把密钥放到 .env 里"
- ❌ 不理解 Vite 的 `VITE_*` 变量会打包到前端

**Claude 的做法**：
```typescript
// ✅ 创建了 Cloudflare Pages Functions
// ✅ API 密钥只在服务端使用
// ✅ 前端通过 /api/search 代理调用
```

**关键洞察**：Claude 理解了**浏览器安全模型**——为什么不能在前端暴露密钥，CORS 是什么，如何用无服务器函数解决。

#### 问题 2：API 路由错误（405）

**最棘手的问题**：
- 部署到 Cloudflare 后，所有搜索请求返回 405 Method Not Allowed
- 多个 AI 都没有找到原因

**Claude 的诊断过程**：
```javascript
// ❌ 错误的代码
const API_BASE_URL = IS_DEV ? "/api" : ""; // 生产环境是空字符串！

// 请求变成：POST /search（405 错误）
// 应该是：POST /api/search（正确）
```

**关键差异**：
- 其他 AI："试试改路由"、"检查 Cloudflare 配置"（盲目试错）
- Claude："让我看看 Network 请求的 URL..."（基于事实分析）

### 第三阶段：性能优化（30分钟）

#### 缓存系统设计

**我的需求**：
> "有人搜索过了就没必要再查，这个设计是对的。"

**Claude 的实现**：
```typescript
// 1. 客户端缓存优先
const cached = getFromCache(query);
if (cached) return cached; // < 0.1秒，不消耗 API

// 2. 速率限制
if (!checkRateLimit()) throw new RateLimitError();

// 3. 自动保存
saveToCache(query, result);
```

**设计亮点**：
- ✅ **速度优化**：缓存命中 < 0.1秒
- ✅ **成本控制**：缓存查询不消耗 API 配额
- ✅ **用户体验**：Toast 通知区分缓存/API

**这让我意识到：好的 AI 不只是写代码，更是产品经理。**

#### 速率限制机制

**我的担忧**：
> "避免有人恶意消耗我的 TOKEN，5秒内不能点两次，每天不超过30次"

**Claude 的方案**：
```typescript
// 设备指纹识别
const deviceId = getDeviceId(); // 基于 navigator.userAgent 等

// 5秒冷却
const cooldownRemaining = Math.max(0, 5000 - (now - lastCallTime));

// 每日限额
const todayCalls = calls[todayKey] || 0;
if (todayCalls >= 30) throw new RateLimitError();
```

**安全设计**：
- 🔒 防止脚本暴力刷接口
- 💾 缓存查询不受限制（保护用户体验）
- 📊 实时配额显示（透明化管理）

### 第四阶段：用户体验优化（1小时）

#### 移除推荐 API

**我的反馈**：
> "刚打开网站会显示'正在加载'，能否直接加载缓存过的？"

**Claude 的理解**：
- ❌ 不是"优化加载动画"
- ✅ 而是**移除不必要的 API 调用**

**最终方案**：
```typescript
// 删除整个推荐加载逻辑
// 打开网站 → 直接显示搜索框 → 瞬间完成 ✨
```

**这让我惊叹：Claude 理解了"Less is More"的产品哲学。**

#### 骨架屏与 Toast 通知

```typescript
// 加载中显示骨架屏
{isLoading ? <SearchResultSkeleton /> : <SearchResults />}

// Toast 通知
showToast('⚡ 从缓存加载（0.1秒）', 'cache');
showToast('✅ 搜索完成（今日剩余 29 次API调用）', 'success');
```

**细节考虑**：
- 用户心理：等待时要有反馈
- 性能感知：区分缓存/API，让用户感知速度
- 配额透明：实时显示剩余次数

---

## 对比：为什么 Claude 更强？

### 1. 问题理解能力

| 维度 | 其他 AI | Claude |
|------|---------|--------|
| **需求分析** | 直接开始写代码 | 先探索项目，理解上下文 |
| **问题定位** | 试错式修改 | 基于日志/网络请求分析 |
| **技术深度** | 知道"是什么" | 理解"为什么" |
| **解决方案** | 表面修复 | 根治问题 |

### 2. 技术深度体现

**案例：405 错误的诊断**

其他 AI 的思路：
```
❌ "试试改 API 路由"
❌ "检查 Cloudflare 配置"
❌ "是不是权限问题？"
```

Claude 的思路：
```
✅ "让我看看 Network 面板的请求 URL"
✅ "发现是 /search 而不是 /api/search"
✅ "找到代码：API_BASE_URL = ""（生产环境）"
✅ "修复：API_BASE_URL = "/api""
```

**差异**：Claude 基于证据推理，而不是盲目猜测。

### 3. 产品思维

**不只是写代码，而是做产品**：

- 🎨 **用户体验**：骨架屏、Toast 通知、实时配额显示
- 💰 **成本控制**：缓存优先、速率限制、批量生成
- 🔒 **安全设计**：API 密钥隐藏、设备指纹、防刷机制
- 📖 **文档完善**：README、批量生成指南、部署文档

**这让我意识到：优秀的 AI 助手 = 技术专家 + 产品经理。**

### 4. 学习能力

**在整个过程中**：
- 我学会了 Cloudflare Pages Functions
- 理解了无服务器架构
- 掌握了速率限制的设计
- 学会了 AI 原生开发的思维

**Claude 不是替代我思考，而是教会我如何思考。**

---

## 成果展示

### 技术指标

| 指标 | 优化前 | 优化后 |
|------|--------|--------|
| **首次加载** | 转圈 10+ 秒 | < 1秒 ✨ |
| **缓存查询** | 3-5秒 | < 0.1秒 ⚡ |
| **API 调用** | 失败（405） | 100% 成功 ✅ |
| **代码体积** | 233KB | 225KB |
| **用户体验** | 挫败感强 | 丝滑流畅 🎉 |

### 开发效率

| 阶段 | 传统方式 | 使用 Claude |
|------|----------|------------|
| **问题定位** | 数小时 | 10分钟 |
| **核心修复** | 数天 | 1小时 |
| **性能优化** | 未知 | 30分钟 |
| **文档完善** | 数小时 | 自动生成 |

**总计**：从 **数天/数周** 缩短到 **3小时**。

---

## AI 原生开发思想总结

这次实战让我深刻理解了 **AI 原生开发**的精髓：

### 1. 从"存储"到"生成"

```javascript
// 传统方式
const tool = await db.query('SELECT * FROM tools WHERE name = ?', name);

// AI 原生
const tool = await llm.generate(`告诉我关于${name}的所有信息`);
```

**核心思想**：不需要预存数据，让 AI 实时生成。

### 2. 成本控制是一等公民

```typescript
// 缓存优先策略
const cached = getFromCache(query);
if (cached) return cached; // 不消耗 API

// 速率限制
if (!checkRateLimit()) {
  throw new RateLimitError('请稍后重试');
}
```

**核心思想**：在 AI 原生时代，调用成本是架构设计的核心考虑。

### 3. 客户端智能化

```javascript
// 浏览器缓存 = 分布式数据库
localStorage.setItem('cache', JSON.stringify(data));

// 设备指纹 = 轻量级用户识别
const deviceId = hash(navigator.userAgent + screen.width + ...);
```

**核心思想**：充分利用客户端能力，减少服务端压力。

### 4. 开放与协作

正如我所说：

> **思想是演变的，开源不构成威胁，只会给更多人启发。**

通过开源这个项目：
- ✅ 展示了完整的 AI 原生开发范式
- ✅ 定义了成本控制的新模式
- ✅ 启发了更多人进入这个领域
- ✅ 推动了 AI 原生开发范式的演进

---

## 给开发者的建议

### 如何选择 AI 编程助手？

**评估维度**：

1. **问题理解能力** 🧠
   - 是先探索项目，还是直接写代码？
   - 能否理解复杂的业务需求？

2. **技术深度** 🛠️
   - 是否理解底层原理（CORS、安全模型等）？
   - 能否基于证据推理，而不是盲目试错？

3. **产品思维** 🎨
   - 是否考虑用户体验？
   - 是否有成本意识？

4. **学习支持** 📚
   - 是否解释技术决策？
   - 是否教会你新知识？

### 我的经验

**Roo Code → Claude 的切换**，让我明白：

- ❌ 不是所有 AI 都一样
- ✅ 好的 AI 能带来质变
- ✅ 技术理解深度 > 知识库大小
- ✅ 产品思维 > 纯粹的代码能力

---

## 写在最后

### 这次实战的意义

**对我而言**：
- ✅ 部署了人生第一个网站（https://douya.chat）
- ✅ 掌握了 AI 原生开发范式
- ✅ 恢复了对 AI 编程助手的信心
- ✅ 找到了真正的技术伙伴

**对社区而言**：
- 📖 完整的 AI 原生开发案例
- 🎯 成本控制的最佳实践
- 🚀 展示了 Claude 的强大能力
- 💡 启发了更多人探索 AI 开发

### 致谢

感谢 **Claude（Anthropic）** 团队打造了如此强大的 AI 助手。

这次实战证明了：**优秀的 AI 不只是工具，更是技术伙伴。**

---

## 项目信息

- **GitHub**: https://github.com/ahua2020qq/psp
- **在线体验**: https://douya.chat
- **技术栈**: React + TypeScript + Cloudflare Pages + DeepSeek API
- **开发时间**: 3小时（vs 传统方式数天/数周）

---

**如果这篇文章对你有帮助，请给个 ⭐️ Star 支持一下！**

让我们一起探索 AI 原生开发的无限可能！🚀
