# OpenSight ç«èŠ±å¤„ç†æµæ°´çº¿ - éƒ¨ç½²æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

OpenSightç«èŠ±ç³»ç»Ÿæ˜¯ä¸€ä¸ªè½»é‡çº§çš„çµæ„Ÿç®¡ç†å·¥å…·ï¼Œå·²é›†æˆåˆ°PSPé¡¹ç›®ä¸­ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âš¡ å¿«é€Ÿæ•è·çµæ„Ÿï¼ˆ10ç§’å†…å®Œæˆï¼‰
- ğŸ¯ çœ‹æ¿å¼çŠ¶æ€ç®¡ç†ï¼ˆcaptured | thinking | experimentingï¼‰
- ğŸ”„ çŠ¶æ€æµè½¬è¿½è¸ª
- ğŸ“Š é¡¹ç›®æ ‡ç­¾åˆ†ç±»

---

## ğŸ—‚ï¸ æ–‡ä»¶æ¸…å•

### æ•°æ®åº“
- `spark-schema.sql` - D1æ•°æ®åº“è¡¨ç»“æ„

### APIæ¥å£ï¼ˆCloudflare Pages Functionsï¼‰
- `functions/api/sparks/index.js` - POSTï¼ˆåˆ›å»ºï¼‰+ GETï¼ˆåˆ—è¡¨ï¼‰
- `functions/api/sparks/[id].js` - PUTï¼ˆæ›´æ–°ï¼‰+ DELETEï¼ˆåˆ é™¤ï¼‰+ GETï¼ˆè¯¦æƒ…ï¼‰

### å‰ç«¯é¡µé¢
- `public/spark-capture.html` - æ•è·é¡µå…¥å£
- `public/spark-board.html` - çœ‹æ¿é¡µå…¥å£
- `src/pages/spark/CapturePage.tsx` - æ•è·é¡µç»„ä»¶
- `src/pages/spark/CapturePage.css` - æ•è·é¡µæ ·å¼
- `src/pages/spark/BoardPage.tsx` - çœ‹æ¿é¡µç»„ä»¶
- `src/pages/spark/BoardPage.css` - çœ‹æ¿é¡µæ ·å¼

### å¯¼èˆªé›†æˆ
- `src/App.tsx` - å·²æ·»åŠ Sparkå¯¼èˆªé“¾æ¥ï¼ˆâš¡ æ•è· | ğŸ¯ å·¥ä½œå°ï¼‰

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ•°æ®åº“è¡¨

**æ–¹æ³•1ï¼šé€šè¿‡Cloudflare Dashboardï¼ˆæ¨èï¼‰**
1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. è¿›å…¥ Workers & Pages â†’ D1
3. é€‰æ‹© `pspdb` æ•°æ®åº“
4. ç‚¹å‡» "Console"
5. å¤åˆ¶ `spark-schema.sql` çš„å†…å®¹å¹¶ç²˜è´´æ‰§è¡Œ

**æ–¹æ³•2ï¼šé€šè¿‡wrangler CLI**
```bash
# æœ¬åœ°æµ‹è¯•
wrangler d1 execute pspdb --local --file=spark-schema.sql

# ç”Ÿäº§ç¯å¢ƒ
wrangler d1 execute pspdb --file=spark-schema.sql
```

**éªŒè¯è¡¨åˆ›å»ºï¼š**
```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
SELECT name FROM sqlite_master WHERE type='table' AND name IN ('sparks', 'spark_logs');

-- æŸ¥çœ‹è¡¨ç»“æ„
.schema sparks
.schema spark_logs
```

---

### ç¬¬äºŒæ­¥ï¼šæœ¬åœ°æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

1. **å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼š**
   ```bash
   npm run dev
   ```

2. **è®¿é—®Sparké¡µé¢ï¼š**
   - æ•è·é¡µï¼š`http://localhost:5173/spark-capture.html`
   - çœ‹æ¿é¡µï¼š`http://localhost:5173/spark-board.html`

3. **æµ‹è¯•APIæ¥å£ï¼š**
   ```bash
   # åˆ›å»ºç«èŠ±
   curl -X POST http://localhost:8788/api/sparks \
     -H "Content-Type: application/json" \
     -d '{"title":"æµ‹è¯•ç«èŠ±","project_tag":"douya"}'

   # è·å–ç«èŠ±åˆ—è¡¨
   curl http://localhost:8788/api/sparks?status=captured
   ```

---

### ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

1. **æ„å»ºé¡¹ç›®ï¼š**
   ```bash
   npm run build
   ```

2. **éƒ¨ç½²åˆ°Cloudflare Pagesï¼š**
   ```bash
   # æ–¹å¼1ï¼šé€šè¿‡Gité›†æˆï¼ˆè‡ªåŠ¨éƒ¨ç½²ï¼‰
   # æ¨é€ä»£ç åˆ°Gitä»“åº“ï¼ŒCloudflareä¼šè‡ªåŠ¨éƒ¨ç½²

   # æ–¹å¼2ï¼šæ‰‹åŠ¨éƒ¨ç½²
   wrangler pages deploy build --project-name=psp-tool-search
   ```

3. **éªŒè¯éƒ¨ç½²ï¼š**
   - è®¿é—®ï¼š`https://douya.chat/spark-capture.html`
   - è®¿é—®ï¼š`https://douya.chat/spark-board.html`
   - æ£€æŸ¥ä¸»ç«™å¯¼èˆªæ˜¯å¦æ˜¾ç¤º âš¡ æ•è· å’Œ ğŸ¯ å·¥ä½œå°

---

## âœ… åŠŸèƒ½æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] è®¿é—®æ•è·é¡µé¢ï¼Œè¡¨å•æ­£å¸¸æ˜¾ç¤º
- [ ] è¾“å…¥æ ‡é¢˜å¹¶æäº¤ï¼ŒæˆåŠŸåˆ›å»ºç«èŠ±
- [ ] æŸ¥çœ‹çœ‹æ¿é¡µé¢ï¼Œæ˜¾ç¤ºåˆšåˆ›å»ºçš„ç«èŠ±
- [ ] ç‚¹å‡»"å†™æ€è€ƒ"æŒ‰é’®ï¼ŒçŠ¶æ€å˜æ›´ä¸ºthinking
- [ ] ç‚¹å‡»"è½¬å®éªŒ"æŒ‰é’®ï¼ŒçŠ¶æ€å˜æ›´ä¸ºexperimenting
- [ ] ç‚¹å‡»"å®Œæˆ"æŒ‰é’®ï¼Œç«èŠ±ä»çœ‹æ¿æ¶ˆå¤±ï¼ˆarchivedçŠ¶æ€ï¼‰
- [ ] ç‚¹å‡»åˆ é™¤æŒ‰é’®ï¼Œç«èŠ±è¢«åˆ é™¤

### è¾¹ç•Œæµ‹è¯•
- [ ] ä¸è¾“å…¥æ ‡é¢˜æäº¤ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
- [ ] æ ‡é¢˜è¶…è¿‡200å­—ç¬¦ï¼Œæ˜¾ç¤ºå­—ç¬¦è®¡æ•°
- [ ] åˆ‡æ¢é¡¹ç›®æ ‡ç­¾ï¼Œæ­£å¸¸ä¿å­˜
- [ ] å¿«æ·é”®Ctrl+Enterï¼Œæ­£å¸¸æäº¤

### å…¼å®¹æ€§æµ‹è¯•
- [ ] Chromeæµè§ˆå™¨æ­£å¸¸
- [ ] Firefoxæµè§ˆå™¨æ­£å¸¸
- [ ] ç§»åŠ¨ç«¯å“åº”å¼å¸ƒå±€æ­£å¸¸
- [ ] æ·±è‰²æ¨¡å¼æ­£å¸¸

---

## ğŸ”§ APIæ¥å£æ–‡æ¡£

### 1. åˆ›å»ºç«èŠ±
**è¯·æ±‚ï¼š**
```http
POST /api/sparks
Content-Type: application/json

{
  "title": "å¯¹è¯åˆ†è½®æ’ä»¶ä¼˜åŒ–",
  "project_tag": "douya",
  "description": "è¯¦ç»†æè¿°...",
  "creator_comment": "å¤‡æ³¨ä¿¡æ¯"
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "ç«èŠ±å·²æ•è·",
  "spark": {
    "id": "uuid",
    "title": "...",
    "status": "captured",
    ...
  }
}
```

### 2. è·å–ç«èŠ±åˆ—è¡¨
**è¯·æ±‚ï¼š**
```http
GET /api/sparks?status=captured&project_tag=douya&limit=10
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "sparks": [...],
  "total": 5
}
```

### 3. æ›´æ–°ç«èŠ±çŠ¶æ€
**è¯·æ±‚ï¼š**
```http
PUT /api/sparks/{id}
Content-Type: application/json

{
  "status": "thinking",
  "note": "å¼€å§‹æ·±å…¥æ€è€ƒ"
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "ç«èŠ±å·²æ›´æ–°",
  "spark": {...}
}
```

### 4. åˆ é™¤ç«èŠ±
**è¯·æ±‚ï¼š**
```http
DELETE /api/sparks/{id}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "ç«èŠ±å·²åˆ é™¤"
}
```

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### sparks è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | TEXT | UUIDä¸»é”® |
| title | TEXT | æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰ |
| description | TEXT | è¯¦ç»†æè¿° |
| status | TEXT | çŠ¶æ€ï¼šcaptured/thinking/experimenting/archived |
| project_tag | TEXT | é¡¹ç›®æ ‡ç­¾ï¼šdouya/opensight/deepseek/other |
| creator_comment | TEXT | å¤‡æ³¨ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | æ›´æ–°æ—¶é—´ |

### spark_logs è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | è‡ªå¢ä¸»é”® |
| spark_id | TEXT | å…³è”sparks.id |
| from_status | TEXT | åŸçŠ¶æ€ |
| to_status | TEXT | æ–°çŠ¶æ€ |
| note | TEXT | æµè½¬åŸå›  |
| created_at | DATETIME | è®°å½•æ—¶é—´ |

---

## ğŸ¨ ä½¿ç”¨æµç¨‹

### 1. å¿«é€Ÿæ•è·çµæ„Ÿ
1. ç‚¹å‡»ä¸»ç«™å¯¼èˆªçš„ âš¡ æ•è·
2. è¾“å…¥çµæ„Ÿæ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰
3. é€‰æ‹©å…³è”é¡¹ç›®ï¼ˆå¯é€‰ï¼‰
4. ç‚¹å‡» "âš¡ å¿«é€Ÿæ•è·" æˆ–æŒ‰ Ctrl+Enter
5. ç³»ç»Ÿæç¤º "âœ“ ç«èŠ±å·²æ•è·ï¼"

### 2. ç®¡ç†ç«èŠ±
1. ç‚¹å‡»ä¸»ç«™å¯¼èˆªçš„ ğŸ¯ å·¥ä½œå°
2. çœ‹æ¿æ˜¾ç¤ºä¸‰åˆ—ï¼šå·²æ•è· | æ€è€ƒä¸­ | å®éªŒä¸­
3. ç‚¹å‡»æŒ‰é’®æ”¹å˜çŠ¶æ€ï¼š
   - å·²æ•è· â†’ ğŸ¤” å†™æ€è€ƒ / ğŸ”¬ è½¬å®éªŒ
   - æ€è€ƒä¸­ â†’ â†©ï¸ è¿”å› / ğŸ”¬ è½¬å®éªŒ
   - å®éªŒä¸­ â†’ â†©ï¸ è¿”å› / âœ… å®Œæˆ
4. ç‚¹å‡» ğŸ—‘ï¸ åˆ é™¤ç«èŠ±

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1ï¼šæäº¤ç«èŠ±åçœ‹ä¸åˆ°ï¼Ÿ
**Aï¼š** æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ç½‘ç»œé”™è¯¯ï¼Œç¡®è®¤APIæ¥å£æ˜¯å¦æ­£å¸¸ã€‚

### Q2ï¼šæ•°æ®åº“è¡¨å·²åˆ›å»ºä½†è¿˜æ˜¯æŠ¥é”™ï¼Ÿ
**Aï¼š** æ£€æŸ¥Cloudflare D1ç»‘å®šæ˜¯å¦æ­£ç¡®ï¼Œç¡®è®¤`wrangler.toml`ä¸­çš„`PSPDB`ç»‘å®šã€‚

### Q3ï¼šé¡µé¢æ ·å¼é”™ä¹±ï¼Ÿ
**Aï¼š** ç¡®è®¤CSSæ–‡ä»¶å·²æ­£ç¡®åŠ è½½ï¼Œæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„404é”™è¯¯ã€‚

### Q4ï¼šçŠ¶æ€æµè½¬åçœ‹æ¿ä¸æ›´æ–°ï¼Ÿ
**Aï¼š** åˆ·æ–°é¡µé¢ï¼Œæ£€æŸ¥APIè¿”å›æ•°æ®æ˜¯å¦æ­£ç¡®ï¼Œç¡®è®¤çŠ¶æ€å€¼æ‹¼å†™æ­£ç¡®ã€‚

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

### åŠŸèƒ½å¢å¼º
- [ ] æ·»åŠ ç¼–è¾‘åŠŸèƒ½ï¼ˆä¿®æ”¹æ ‡é¢˜ã€æè¿°ï¼‰
- [ ] æ·»åŠ æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½
- [ ] æ·»åŠ æ‹–æ‹½æ’åºï¼ˆDrag & Dropï¼‰
- [ ] æ·»åŠ æ‰¹é‡æ“ä½œ
- [ ] æ·»åŠ å¯¼å‡ºåŠŸèƒ½ï¼ˆCSV/JSONï¼‰

### ä½“éªŒä¼˜åŒ–
- [ ] æ·»åŠ ç¦»çº¿æ”¯æŒï¼ˆPWAï¼‰
- [ ] æ·»åŠ æ¨é€é€šçŸ¥
- [ ] æ·»åŠ æ•°æ®ç»Ÿè®¡å›¾è¡¨
- [ ] æ·»åŠ åä½œåŠŸèƒ½ï¼ˆå¤šç”¨æˆ·ï¼‰

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥æœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. æŸ¥çœ‹Cloudflare Dashboardçš„æ—¥å¿—
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

---

**éƒ¨ç½²å®Œæˆåï¼Œä½ å°†æ‹¥æœ‰ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„çµæ„Ÿç®¡ç†ç³»ç»Ÿï¼** âœ¨
